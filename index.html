<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Auditoría Lean Construction</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #ffffff;
      color: #1d1d1f;
      text-align: center;
    }

    /* SPLASH INICIAL */
    #splashInicial {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, #0f4c75, #3282b8, #bbe1fa);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: #fff;
      z-index: 1000;
    }

    #splashInicial h1 {
      font-size: 36px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    #splashInicial .empresa {
      font-size: 24px;
      font-weight: 400;
      margin-bottom: 30px;
      opacity: 0.9;
    }

    #splashInicial .version {
      position: absolute;
      bottom: 30px;
      font-size: 14px;
      opacity: 0.9;
      color: rgba(255, 255, 255, 0.9);
    }

    .screen {
      display: none;
      min-height: 100vh;
      padding: 60px 20px;
      box-sizing: border-box;
    }

    .active {
      display: block;
    }

    h1 {
      font-size: 36px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    h2 {
      font-size: 22px;
      font-weight: 400;
      color: #6e6e73;
      margin-bottom: 40px;
    }

    button {
      background-color: #0071e3;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 14px 24px;
      font-size: 16px;
      margin: 10px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #005bb5;
    }

    button.secondary {
      background-color: #34c759;
    }

    button.secondary:hover {
      background-color: #2aa44f;
    }

    button.tertiary {
      background-color: #ff9500;
    }

    button.tertiary:hover {
      background-color: #e57c00;
    }

    button.complete-btn {
      background-color: #34c759;
      padding: 8px 16px;
      font-size: 14px;
    }

    button.complete-btn:hover {
      background-color: #2aa44f;
    }

    button.complete-btn.completed {
      background-color: #8e8e93;
      cursor: not-allowed;
    }

    form {
      max-width: 600px;
      margin: auto;
      text-align: left;
    }

    label {
      font-weight: 500;
      display: block;
      margin-top: 20px;
    }

    select, textarea, input {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: 1px solid #d2d2d7;
      font-size: 15px;
      box-sizing: border-box;
    }

    textarea {
      min-height: 120px;
      resize: vertical;
      font-family: inherit;
    }

    input {
      font-family: inherit;
    }

    .success {
      color: #0071e3;
      font-size: 18px;
      margin-top: 20px;
    }

    .activities-list, .notes-list {
      max-width: 800px;
      margin: 40px auto;
      text-align: left;
    }

    .activity-item, .note-item {
      background-color: #f5f5f7;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid #0071e3;
    }

    .activity-item.completed {
      border-left-color: #34c759;
      background-color: #f0f9f0;
    }

    .note-item.observacion {
      border-left-color: #0071e3;
    }

    .note-item.incidencia {
      border-left-color: #ff3b30;
      background-color: #fff0f0;
    }

    .note-item.propuesta {
      border-left-color: #34c759;
      background-color: #f0f9f0;
    }

    .activity-header, .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .activity-detail, .note-detail {
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .activity-priority, .note-type {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }

    .priority-low {
      background-color: #34c759;
      color: white;
    }

    .priority-medium {
      background-color: #ff9500;
      color: white;
    }

    .priority-high {
      background-color: #ff3b30;
      color: white;
    }

    .type-observacion {
      background-color: #0071e3;
      color: white;
    }

    .type-incidencia {
      background-color: #ff3b30;
      color: white;
    }

    .type-propuesta {
      background-color: #34c759;
      color: white;
    }

    .activity-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      margin-left: 10px;
    }

    .status-open {
      background-color: #0071e3;
      color: white;
    }

    .status-completed {
      background-color: #34c759;
      color: white;
    }

    .activity-actions, .note-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
    }

    .back-button {
      background-color: #8e8e93;
      margin-top: 30px;
    }

    .back-button:hover {
      background-color: #6e6e73;
    }

    .splash-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }

    .splash-buttons {
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: center;
    }

    .splash-buttons button {
      width: 300px;
      max-width: 90%;
    }

    .project-name {
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 5px;
      color: #1d1d1f;
    }
  </style>
</head>

<body>

<!-- SPLASH INICIAL (El que pediste restaurar) -->
<div id="splashInicial">
  <h1>Auditoría Lean Construction</h1>
  <div class="empresa">MARVAL S.A.</div>
  <div class="version">Formulario Lean Versión 1.2</div>
</div>

<!-- SPLASH PRINCIPAL CON LAS OPCIONES -->
<div id="splash" class="screen">
  <div class="splash-container">
    <div>
      <h1>Auditoría Lean Construction</h1>
      <h2>Evaluación del nivel de madurez en obra</h2>
    </div>
    
    <div class="splash-buttons">
      <button onclick="mostrarResponsables()">Iniciar auditoría</button>
      <button class="secondary" onclick="mostrarRegistroActividades()">Registro de actividades Lean</button>
      <button class="tertiary" onclick="mostrarRegistroNovedades()">Registro de novedades</button>
    </div>
  </div>
</div>

<!-- SELECCIÓN RESPONSABLE -->
<div id="responsables" class="screen">
  <h1>Seleccione el responsable</h1>

  <button onclick="seleccionarResponsable('Ing. Juan Romero - Dirección Nacional')">
    Dirección Nacional
  </button>

  <button onclick="seleccionarResponsable('Ing. Camilo Pulgarin - Sucursal Bogotá')">
    Sucursal Bogotá
  </button>

  <button onclick="seleccionarResponsable('Ing. Paola Ramirez - Sucursal Bucaramanga')">
    Sucursal Bucaramanga
  </button>

  <button onclick="seleccionarResponsable('Ing. Daniela Herrera - Sucursal Costa')">
    Sucursal Costa
  </button>

  <button class="back-button" onclick="volverAlInicioDesdeResponsables()">Volver al inicio</button>
</div>

<!-- FORMULARIO AUDITORÍA -->
<div id="formularioScreen" class="screen">
  <h1 id="bienvenida"></h1>

  <form id="formAuditoria">
    <label>Tipo de reunión evaluada</label>
    <select name="tipoReunion" required>
      <option value="">Seleccione una opción</option>
      <option value="Intermedia - Equipo Administrativo">
        Intermedia (Equipo Administrativo)
      </option>
      <option value="Semanal - Contratistas y Obra">
        Semanal (Contratistas / Directores / Residentes)
      </option>
    </select>

    <label>Nivel de cumplimiento Lean observado</label>
    <select name="nivelMadurez" required>
      <option value="">Seleccione una opción</option>
      <option value="Inicial">Inicial</option>
      <option value="En desarrollo">En desarrollo</option>
      <option value="Estandarizado">Estandarizado</option>
      <option value="Optimizado">Optimizado</option>
    </select>

    <button type="submit" style="margin-top:30px;">Guardar auditoría</button>
  </form>

  <div id="mensajeExito" class="success"></div>

  <button class="back-button" onclick="volverAlInicioDesdeAuditoria()">Volver al inicio</button>
</div>

<!-- REGISTRO DE ACTIVIDADES LEAN -->
<div id="registroActividadesScreen" class="screen">
  <h1>Registro de Actividades Lean</h1>
  <h2>Gestión de tareas del equipo Lean</h2>

  <form id="formActividad">
    <label>Detalle de la tarea</label>
    <textarea name="detalle" placeholder="Describe la tarea a realizar..." required></textarea>

    <label>Prioridad</label>
    <select name="prioridad" required>
      <option value="">Seleccione una opción</option>
      <option value="Baja">Baja</option>
      <option value="Media">Media</option>
      <option value="Alta">Alta</option>
    </select>

    <button type="submit" style="margin-top:30px;">Registrar actividad</button>
  </form>

  <div id="mensajeActividadExito" class="success"></div>

  <div class="activities-list" id="listaActividades">
    <!-- Las actividades se cargarán aquí dinámicamente -->
  </div>

  <button class="back-button" onclick="volverAlInicio()">Volver al inicio</button>
</div>

<!-- REGISTRO DE NOVEDADES -->
<div id="registroNovedadesScreen" class="screen">
  <h1>Registro de Novedades</h1>
  <h2>Notas de los auditores</h2>

  <form id="formNovedad">
    <label>Proyecto</label>
    <input type="text" name="proyecto" placeholder="Nombre del proyecto" required>

    <label>Tipo de nota</label>
    <select name="tipo" required>
      <option value="">Seleccione una opción</option>
      <option value="Observación de obra">Observación de obra</option>
      <option value="Incidencia">Incidencia</option>
      <option value="Propuesta">Propuesta</option>
    </select>

    <label>Detalle</label>
    <textarea name="detalle" placeholder="Describe la novedad en detalle..." required></textarea>

    <button type="submit" style="margin-top:30px;">Registrar novedad</button>
  </form>

  <div id="mensajeNovedadExito" class="success"></div>

  <div class="notes-list" id="listaNovedades">
    <!-- Las novedades se cargarán aquí dinámicamente -->
  </div>

  <button class="back-button" onclick="volverAlInicioDesdeNovedades()">Volver al inicio</button>
</div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBlRbAQZVSWSZgNw8w4Iie7WsdSdogRX5o",
    authDomain: "formularioobra.firebaseapp.com",
    projectId: "formularioobra",
    storageBucket: "formularioobra.firebasestorage.app",
    messagingSenderId: "483554481916",
    appId: "1:483554481916:web:c2b175955247a1b6f56979"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let ResponsableRegistro = "";

  // Ocultar splash inicial después de 1.5 segundos
  setTimeout(function() {
    document.getElementById("splashInicial").style.display = "none";
    document.getElementById("splash").classList.add("active");
  }, 1500);

  // Navegación entre pantallas
  function mostrarResponsables() {
    document.getElementById("splash").classList.remove("active");
    document.getElementById("responsables").classList.add("active");
  }

  function mostrarRegistroActividades() {
    document.getElementById("splash").classList.remove("active");
    document.getElementById("registroActividadesScreen").classList.add("active");
    cargarActividades();
  }

  function mostrarRegistroNovedades() {
    document.getElementById("splash").classList.remove("active");
    document.getElementById("registroNovedadesScreen").classList.add("active");
    cargarNovedades();
  }

  function volverAlInicio() {
    document.getElementById("registroActividadesScreen").classList.remove("active");
    document.getElementById("responsables").classList.remove("active");
    document.getElementById("formularioScreen").classList.remove("active");
    document.getElementById("registroNovedadesScreen").classList.remove("active");
    document.getElementById("splash").classList.add("active");
    document.getElementById("mensajeExito").innerText = "";
    document.getElementById("mensajeActividadExito").innerText = "";
    document.getElementById("mensajeNovedadExito").innerText = "";
  }

  function volverAlInicioDesdeResponsables() {
    document.getElementById("responsables").classList.remove("active");
    document.getElementById("splash").classList.add("active");
  }

  function volverAlInicioDesdeAuditoria() {
    document.getElementById("formularioScreen").classList.remove("active");
    document.getElementById("splash").classList.add("active");
    document.getElementById("mensajeExito").innerText = "";
  }

  function volverAlInicioDesdeNovedades() {
    document.getElementById("registroNovedadesScreen").classList.remove("active");
    document.getElementById("splash").classList.add("active");
    document.getElementById("mensajeNovedadExito").innerText = "";
  }

  function seleccionarResponsable(responsable) {
    ResponsableRegistro = responsable;

    document.getElementById("responsables").classList.remove("active");
    document.getElementById("formularioScreen").classList.add("active");

    document.getElementById("bienvenida").innerText =
      "Bienvenido, " + responsable;
  }

  // Formulario de auditoría
  document.getElementById("formAuditoria").addEventListener("submit", function(e) {
    e.preventDefault();

    const tipoReunion = this.tipoReunion.value;
    const nivelMadurez = this.nivelMadurez.value;

    db.collection("auditoriasLean").add({
      ResponsableRegistro: ResponsableRegistro,
      TipoReunion: tipoReunion,
      NivelMadurez: nivelMadurez,
      FechaRegistro: new Date()
    })
    .then(() => {
      document.getElementById("mensajeExito").innerText =
        "Auditoría registrada correctamente.";
      this.reset();
    })
    .catch(error => {
      alert("Error al guardar: " + error);
    });
  });

  // Formulario de actividades
  document.getElementById("formActividad").addEventListener("submit", function(e) {
    e.preventDefault();

    const detalle = this.detalle.value;
    const prioridad = this.prioridad.value;

    db.collection("actividadesLean").add({
      detalle: detalle,
      prioridad: prioridad,
      estado: "Abierto",
      fechaCreacion: new Date(),
      fechaCompletado: null
    })
    .then(() => {
      document.getElementById("mensajeActividadExito").innerText =
        "Actividad registrada correctamente.";
      this.reset();
      cargarActividades();
    })
    .catch(error => {
      alert("Error al guardar la actividad: " + error);
    });
  });

  // Formulario de novedades
  document.getElementById("formNovedad").addEventListener("submit", function(e) {
    e.preventDefault();

    const proyecto = this.proyecto.value;
    const tipo = this.tipo.value;
    const detalle = this.detalle.value;

    db.collection("novedadesAuditores").add({
      proyecto: proyecto,
      tipo: tipo,
      detalle: detalle,
      fechaRegistro: new Date()
    })
    .then(() => {
      document.getElementById("mensajeNovedadExito").innerText =
        "Novedad registrada correctamente.";
      this.reset();
      cargarNovedades();
    })
    .catch(error => {
      alert("Error al guardar la novedad: " + error);
    });
  });

  // Cargar y mostrar actividades
  function cargarActividades() {
    const listaActividades = document.getElementById("listaActividades");
    listaActividades.innerHTML = "<h3>Actividades Registradas</h3>";

    db.collection("actividadesLean")
      .orderBy("fechaCreacion", "desc")
      .get()
      .then((querySnapshot) => {
        if (querySnapshot.empty) {
          listaActividades.innerHTML += "<p>No hay actividades registradas.</p>";
          return;
        }

        querySnapshot.forEach((doc) => {
          const actividad = doc.data();
          const actividadId = doc.id;
          
          const priorityClass = `priority-${actividad.prioridad.toLowerCase()}`;
          const statusClass = actividad.estado === "Completado" ? "status-completed" : "status-open";
          
          const activityElement = document.createElement("div");
          activityElement.className = `activity-item ${actividad.estado === "Completado" ? "completed" : ""}`;
          activityElement.innerHTML = `
            <div class="activity-header">
              <div>
                <span class="activity-priority ${priorityClass}">Prioridad: ${actividad.prioridad}</span>
                <span class="activity-status ${statusClass}">${actividad.estado}</span>
              </div>
              <small>${new Date(actividad.fechaCreacion.seconds * 1000).toLocaleDateString()}</small>
            </div>
            <div class="activity-detail">${actividad.detalle}</div>
            <div class="activity-actions">
              <div>
                ${actividad.fechaCompletado ? 
                  `<small>Completado: ${new Date(actividad.fechaCompletado.seconds * 1000).toLocaleDateString()}</small>` : 
                  ''}
              </div>
              <button class="complete-btn ${actividad.estado === "Completado" ? "completed" : ""}" 
                      onclick="completarActividad('${actividadId}')" 
                      ${actividad.estado === "Completado" ? "disabled" : ""}>
                ${actividad.estado === "Completado" ? "✓ Completado" : "Marcar como completado"}
              </button>
            </div>
          `;
          
          listaActividades.appendChild(activityElement);
        });
      })
      .catch((error) => {
        console.error("Error al cargar actividades: ", error);
        listaActividades.innerHTML += "<p>Error al cargar las actividades.</p>";
      });
  }

  // Cargar y mostrar novedades
  function cargarNovedades() {
    const listaNovedades = document.getElementById("listaNovedades");
    listaNovedades.innerHTML = "<h3>Novedades Registradas</h3>";

    db.collection("novedadesAuditores")
      .orderBy("fechaRegistro", "desc")
      .get()
      .then((querySnapshot) => {
        if (querySnapshot.empty) {
          listaNovedades.innerHTML += "<p>No hay novedades registradas.</p>";
          return;
        }

        querySnapshot.forEach((doc) => {
          const novedad = doc.data();
          const novedadId = doc.id;
          
          const typeClass = `type-${novedad.tipo.toLowerCase().split(' ')[0]}`;
          const itemClass = novedad.tipo.toLowerCase().split(' ')[0];
          
          const noteElement = document.createElement("div");
          noteElement.className = `note-item ${itemClass}`;
          noteElement.innerHTML = `
            <div class="note-header">
              <div>
                <div class="project-name">${novedad.proyecto}</div>
                <span class="note-type ${typeClass}">${novedad.tipo}</span>
              </div>
              <small>${new Date(novedad.fechaRegistro.seconds * 1000).toLocaleDateString()}</small>
            </div>
            <div class="note-detail">${novedad.detalle}</div>
          `;
          
          listaNovedades.appendChild(noteElement);
        });
      })
      .catch((error) => {
        console.error("Error al cargar novedades: ", error);
        listaNovedades.innerHTML += "<p>Error al cargar las novedades.</p>";
      });
  }

  // Función para completar una actividad
  function completarActividad(actividadId) {
    db.collection("actividadesLean").doc(actividadId).update({
      estado: "Completado",
      fechaCompletado: new Date()
    })
    .then(() => {
      cargarActividades();
    })
    .catch((error) => {
      alert("Error al actualizar la actividad: " + error);
    });
  }
</script>

</body>
</html>
